<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Protamine Dose Calculator</title>    <style>        body {            font-family: Arial, sans-serif;            line-height: 1.6;            margin: 20px;            background-color: #f4f4f4;            color: #333;        }        .container {            max-width: 700px;            margin: auto;            background: #fff;            padding: 20px;            border-radius: 8px;            box-shadow: 0 0 10px rgba(0,0,0,0.1);        }        h1, h2 {            color: #333;            text-align: center;        }        .form-group {            margin-bottom: 15px;        }        label {            display: block;            margin-bottom: 5px;            font-weight: bold;        }        input[type="number"], input[type="time"], input[type="text"] {            width: calc(100% - 22px); /* Adjust for padding and border */            padding: 10px;            border: 1px solid #ddd;            border-radius: 4px;            box-sizing: border-box;        }        input[type="time"] { /* More specific for time inputs */            width: auto; /* Allow time input to be its natural width */            min-width: 120px;        }        button {            display: block;            width: 100%;            padding: 10px 15px;            background-color: #007bff;            color: white;            border: none;            border-radius: 4px;            cursor: pointer;            font-size: 16px;            margin-top: 20px;        }        button:hover {            background-color: #0056b3;        }        .results, .log-section {            margin-top: 20px;            padding: 15px;            background-color: #e9ecef;            border-radius: 4px;        }        .results p, .log-section p {            margin: 5px 0;        }        .results strong {            color: #0056b3;        }        .error-message {            color: red;            font-weight: bold;            margin-top: 10px;        }        .disclaimer {            font-size: 0.9em;            color: #666;            margin-top: 15px;            border-top: 1px solid #eee;            padding-top: 10px;        }        .additional-dose-group {            display: flex;            gap: 10px; /* Space between dose and time inputs */            align-items: center; /* Align items vertically */            margin-bottom: 10px;        }        .additional-dose-group label {             margin-bottom: 0; /* Remove bottom margin for inline labels */             min-width: 60px; /* Give some fixed width to "Dose:" / "Time:" labels */        }        .additional-dose-group input[type="number"],        .additional-dose-group input[type="time"] {            flex-grow: 1; /* Allow inputs to take available space */            width: auto; /* Reset width to allow flex-grow */        }    </style></head><body>    <div class="container">        <h1>Protamine Dose Calculator</h1>        <div class="form-group">            <label for="heparinDose">Last Heparin Dose (units):</label>            <input type="number" id="heparinDose" placeholder="e.g., 5000">        </div>        <div class="form-group">            <label for="heparinTimeGiven">Time Last Heparin Dose Given:</label>            <input type="time" id="heparinTimeGiven">        </div>        <div class="form-group">            <label for="currentTimeInput">Current Time:</label>            <input type="time" id="currentTimeInput">        </div>        <button onclick="calculateProtamine()">Calculate Recommended Protamine Dose</button>        <div class="results" style="display:none;">            <h2>Calculation Results</h2>            <p>Time since last heparin: <strong id="timeDiffDisplay">---</strong> minutes</p>            <p>Recommended Initial Protamine Dose: <strong id="recDoseDisplay">---</strong> mg</p>            <p class="disclaimer"><strong>DISCLAIMER:</strong> This is a calculated suggestion based on general guidelines. Administer protamine based on clinical judgment, patient factors, and institutional protocols. Maximum recommended single dose is often 50mg. <strong>VALIDATE THIS CALCULATOR WITH QUALIFIED MEDICAL PROFESSIONALS BEFORE CLINICAL USE.</strong></p>        </div>        <div id="calcErrorDisplay" class="error-message"></div>        <div class="log-section">            <h2>Log Administered Protamine</h2>            <div class="form-group">                <label for="actualInitialProtamineDose">Actual Initial Protamine Dose (mg):</label>                <input type="number" id="actualInitialProtamineDose" placeholder="e.g., 25">            </div>            <div class="form-group">                <label for="actualInitialProtamineTime">Time Initial Protamine Given:</label>                <input type="time" id="actualInitialProtamineTime">            </div>            <h3>Additional Protamine Doses (Optional)</h3>            <div id="additionalDosesContainer">                <!-- Additional doses will be generated here by JS -->            </div>        </div>    </div>    <script>        document.addEventListener('DOMContentLoaded', function() {            prefillCurrentTime();            generateAdditionalDoseFields(7); // Generate 7 slots        });        function prefillCurrentTime() {            const now = new Date();            const hours = String(now.getHours()).padStart(2, '0');            const minutes = String(now.getMinutes()).padStart(2, '0');            document.getElementById('currentTimeInput').value = `${hours}:${minutes}`;        }        function generateAdditionalDoseFields(count) {            const container = document.getElementById('additionalDosesContainer');            for (let i = 1; i <= count; i++) {                const group = document.createElement('div');                group.className = 'additional-dose-group';                group.innerHTML = `                    <label for="additionalProtamineDose${i}">Dose ${i} (mg):</label>                    <input type="number" id="additionalProtamineDose${i}" placeholder="mg">                    <label for="additionalProtamineTime${i}">Time ${i}:</label>                    <input type="time" id="additionalProtamineTime${i}">                `;                container.appendChild(group);            }        }        function parseHHMMToDate(timeStr) {            if (!timeStr || !/^\d{2}:\d{2}$/.test(timeStr)) return null;            const [hours, minutes] = timeStr.split(':').map(Number);            if (hours < 0 || hours > 23 || minutes < 0 || minutes > 59) return null;            const date = new Date(); // Use today's date as a base            date.setHours(hours, minutes, 0, 0); // Set H, M, reset S, MS            return date;        }        function calculateProtamine() {            const heparinDoseStr = document.getElementById('heparinDose').value;            const heparinTimeGivenStr = document.getElementById('heparinTimeGiven').value;            const currentTimeInputStr = document.getElementById('currentTimeInput').value;            const errorDisplay = document.getElementById('calcErrorDisplay');            const resultsDiv = document.querySelector('.results');            errorDisplay.textContent = '';            resultsDiv.style.display = 'none'; // Hide results initially            let errorMessages = [];            const heparinDose = parseFloat(heparinDoseStr);            if (isNaN(heparinDose) || heparinDose <= 0) {                errorMessages.push("Heparin dose must be a positive number.");            }            const heparinTimeDate = parseHHMMToDate(heparinTimeGivenStr);            if (!heparinTimeDate) {                errorMessages.push("Invalid 'Heparin Time Given'. Use HH:MM format.");            }            const currentTimeDate = parseHHMMToDate(currentTimeInputStr);            if (!currentTimeDate) {                errorMessages.push("Invalid 'Current Time'. Use HH:MM format.");            }            if (errorMessages.length > 0) {                errorDisplay.innerHTML = errorMessages.join("<br>");                return;            }            let timeDiffMillis = currentTimeDate.getTime() - heparinTimeDate.getTime();            // Handle crossing midnight: if heparin time is "later" than current time,            // assume it was on the previous day. Add 24 hours to the difference.            if (timeDiffMillis < 0) {                timeDiffMillis += 24 * 60 * 60 * 1000;            }            const timeDiffMinutes = Math.round(timeDiffMillis / (60 * 1000));            document.getElementById('timeDiffDisplay').textContent = timeDiffMinutes;            let protamineMgPer100U;            // CLINICALLY VALIDATE THIS DOSING LOGIC            if (timeDiffMinutes < 0) { // Should not happen with above logic, but safeguard                 errorMessages.push("Time calculation error (negative duration).");                 protamineMgPer100U = 0;            } else if (timeDiffMinutes <= 30) {                protamineMgPer100U = 1.0;            } else if (timeDiffMinutes <= 60) { // 31-60 minutes                protamineMgPer100U = 0.75;            } else if (timeDiffMinutes <= 120) { // 61-120 minutes                protamineMgPer100U = 0.5;            } else if (timeDiffMinutes <= 180) { // 121-180 minutes (2-3 hours)                protamineMgPer100U = 0.375;            } else { // More than 180 minutes (3 hours)                protamineMgPer100U = 0.25;            }            if (errorMessages.length > 0) { // Re-check after time diff logic for any new errors                errorDisplay.innerHTML = errorMessages.join("<br>");                return;            }            let calculatedDose = (heparinDose / 100) * protamineMgPer100U;            // Max single dose (e.g., 50mg) - CONSULT GUIDELINES            let recommendedDose = Math.min(calculatedDose, 50);            recommendedDose = Math.round(recommendedDose * 10) / 10; // Round to one decimal place            document.getElementById('recDoseDisplay').textContent = recommendedDose;            resultsDiv.style.display = 'block'; // Show results        }    </script></body></html>